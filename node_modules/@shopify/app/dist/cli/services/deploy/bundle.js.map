{"version":3,"file":"bundle.js","sourceRoot":"","sources":["../../../../src/cli/services/deploy/bundle.ts"],"names":[],"mappings":"AAEA,OAAO,EAAC,GAAG,EAAC,MAAM,gCAAgC,CAAA;AAClD,OAAO,EAAC,gBAAgB,EAAC,MAAM,0BAA0B,CAAA;AAEzD,OAAO,EAAC,oBAAoB,EAAE,SAAS,EAAE,SAAS,EAAC,MAAM,0BAA0B,CAAA;AACnF,OAAO,EAAC,QAAQ,EAAC,MAAM,4BAA4B,CAAA;AASnD,MAAM,CAAC,KAAK,UAAU,wBAAwB,CAAC,OAAsB;IACnE,MAAM,oBAAoB,CAAC,KAAK,EAAE,MAAM,EAAE,EAAE;QAC1C,MAAM,eAAe,GAAG,QAAQ,CAAC,MAAM,EAAE,QAAQ,CAAC,CAAA;QAClD,MAAM,SAAS,CAAC,eAAe,CAAC,CAAA;QAChC,MAAM,SAAS,CAAC,QAAQ,CAAC,eAAe,EAAE,UAAU,CAAC,CAAC,CAAA;QAEtD,MAAM,gBAAgB,CAAC;YACrB,SAAS,EAAE,OAAO,CAAC,GAAG,CAAC,aAAa,CAAC,GAAG,CAAC,CAAC,SAAS,EAAE,EAAE;gBACrD,OAAO;oBACL,MAAM,EAAE,SAAS,CAAC,eAAe;oBACjC,MAAM,EAAE,KAAK,EAAE,MAAgB,EAAE,MAAgB,EAAE,MAAmB,EAAE,EAAE;wBACxE,MAAM,SAAS,CAAC,cAAc,CAC5B,EAAC,MAAM,EAAE,MAAM,EAAE,MAAM,EAAE,GAAG,EAAE,OAAO,CAAC,GAAG,EAAC,EAC1C,OAAO,CAAC,WAAW,EACnB,eAAe,CAChB,CAAA;oBACH,CAAC;iBACF,CAAA;YACH,CAAC,CAAC;YACF,cAAc,EAAE,KAAK;SACtB,CAAC,CAAA;QAEF,IAAI,OAAO,CAAC,UAAU,EAAE;YACtB,MAAM,GAAG,CAAC;gBACR,cAAc,EAAE,eAAe;gBAC/B,aAAa,EAAE,OAAO,CAAC,UAAU;aAClC,CAAC,CAAA;SACH;IACH,CAAC,CAAC,CAAA;AACJ,CAAC","sourcesContent":["import {AppInterface} from '../../models/app/app.js'\nimport {Identifiers} from '../../models/app/identifiers.js'\nimport {zip} from '@shopify/cli-kit/node/archiver'\nimport {renderConcurrent} from '@shopify/cli-kit/node/ui'\nimport {AbortSignal} from '@shopify/cli-kit/node/abort'\nimport {inTemporaryDirectory, mkdirSync, touchFile} from '@shopify/cli-kit/node/fs'\nimport {joinPath} from '@shopify/cli-kit/node/path'\nimport {Writable} from 'stream'\n\nexport interface BundleOptions {\n  app: AppInterface\n  bundlePath?: string\n  identifiers: Identifiers\n}\n\nexport async function bundleAndBuildExtensions(options: BundleOptions) {\n  await inTemporaryDirectory(async (tmpDir) => {\n    const bundleDirectory = joinPath(tmpDir, 'bundle')\n    await mkdirSync(bundleDirectory)\n    await touchFile(joinPath(bundleDirectory, '.shopify'))\n\n    await renderConcurrent({\n      processes: options.app.allExtensions.map((extension) => {\n        return {\n          prefix: extension.localIdentifier,\n          action: async (stdout: Writable, stderr: Writable, signal: AbortSignal) => {\n            await extension.buildForBundle(\n              {stderr, stdout, signal, app: options.app},\n              options.identifiers,\n              bundleDirectory,\n            )\n          },\n        }\n      }),\n      showTimestamps: false,\n    })\n\n    if (options.bundlePath) {\n      await zip({\n        inputDirectory: bundleDirectory,\n        outputZipPath: options.bundlePath,\n      })\n    }\n  })\n}\n"]}