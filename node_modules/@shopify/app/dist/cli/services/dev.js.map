{"version":3,"file":"dev.js","sourceRoot":"","sources":["../../../src/cli/services/dev.ts"],"names":[],"mappings":"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","sourcesContent":["import {ensureDevContext} from './context.js'\nimport {\n  generateFrontendURL,\n  generatePartnersURLs,\n  getURLs,\n  shouldOrPromptUpdateURLs,\n  startTunnelPlugin,\n  updateURLs,\n} from './dev/urls.js'\nimport {installAppDependencies} from './dependencies.js'\nimport {devUIExtensions} from './dev/extension.js'\nimport {outputUpdateURLsResult, renderDev} from './dev/ui.js'\nimport {themeExtensionArgs} from './dev/theme-extension-args.js'\nimport {fetchSpecifications} from './generate/fetch-extension-specifications.js'\nimport {sendUninstallWebhookToAppServer} from './webhook/send-app-uninstalled-webhook.js'\nimport {ensureDeploymentIdsPresence} from './context/identifiers.js'\nimport {setupConfigWatcher, setupDraftableExtensionBundler, setupFunctionWatcher} from './dev/extension/bundler.js'\nimport {updateExtensionDraft} from './dev/update-extension.js'\nimport {setCachedAppInfo} from './local-storage.js'\nimport {DeploymentMode} from './deploy/mode.js'\nimport {canEnablePreviewMode} from './extensions/common.js'\nimport {\n  ReverseHTTPProxyTarget,\n  runConcurrentHTTPProcessesAndPathForwardTraffic,\n} from '../utilities/app/http-reverse-proxy.js'\nimport {\n  getAppScopesArray,\n  AppInterface,\n  Web,\n  WebType,\n  isLegacyAppSchema,\n  isCurrentAppSchema,\n} from '../models/app/app.js'\nimport metadata from '../metadata.js'\nimport {fetchProductVariant} from '../utilities/extensions/fetch-product-variant.js'\nimport {loadApp} from '../models/app/loader.js'\nimport {getAppIdentifiers, updateAppIdentifiers} from '../models/app/identifiers.js'\nimport {getAnalyticsTunnelType} from '../utilities/analytics.js'\nimport {buildAppURLForWeb} from '../utilities/app/app-url.js'\nimport {HostThemeManager} from '../utilities/host-theme-manager.js'\n\nimport {ExtensionInstance} from '../models/extensions/extension-instance.js'\nimport {AbortController, AbortSignal} from '@shopify/cli-kit/node/abort'\nimport {Config} from '@oclif/core'\nimport {reportAnalyticsEvent} from '@shopify/cli-kit/node/analytics'\nimport {execCLI2} from '@shopify/cli-kit/node/ruby'\nimport {checkPortAvailability, getAvailableTCPPort} from '@shopify/cli-kit/node/tcp'\nimport {hashString} from '@shopify/cli-kit/node/crypto'\nimport {exec} from '@shopify/cli-kit/node/system'\nimport {isSpinEnvironment, spinFqdn} from '@shopify/cli-kit/node/context/spin'\nimport {\n  AdminSession,\n  ensureAuthenticatedAdmin,\n  ensureAuthenticatedPartners,\n  ensureAuthenticatedStorefront,\n} from '@shopify/cli-kit/node/session'\nimport {OutputProcess, formatPackageManagerCommand} from '@shopify/cli-kit/node/output'\nimport {AbortError} from '@shopify/cli-kit/node/error'\nimport {getBackendPort} from '@shopify/cli-kit/node/environment'\nimport {TunnelClient} from '@shopify/cli-kit/node/plugins/tunnel'\nimport {renderWarning} from '@shopify/cli-kit/node/ui'\nimport {basename} from '@shopify/cli-kit/node/path'\nimport {Writable} from 'stream'\n\nexport const MANIFEST_VERSION = '3'\n\nexport interface DevOptions {\n  directory: string\n  id?: number\n  configName?: string\n  apiKey?: string\n  storeFqdn?: string\n  reset: boolean\n  update: boolean\n  commandConfig: Config\n  skipDependenciesInstallation: boolean\n  subscriptionProductUrl?: string\n  checkoutCartUrl?: string\n  tunnelUrl?: string\n  noTunnel: boolean\n  theme?: string\n  themeExtensionPort?: number\n  notify?: string\n}\n\nasync function dev(options: DevOptions) {\n  // Be optimistic about tunnel creation and do it as early as possible\n  const tunnelPort = await getAvailableTCPPort()\n\n  let tunnelClient: TunnelClient | undefined\n  if (!options.tunnelUrl && !options.noTunnel) {\n    tunnelClient = await startTunnelPlugin(options.commandConfig, tunnelPort, 'cloudflare')\n  }\n\n  const token = await ensureAuthenticatedPartners()\n  const {\n    storeFqdn,\n    remoteApp,\n    remoteAppUpdated,\n    updateURLs: cachedUpdateURLs,\n    configName,\n  } = await ensureDevContext(options, token)\n\n  const apiKey = remoteApp.apiKey\n  const developmentStorePreviewEnabled = remoteApp.developmentStorePreviewEnabled\n  const specifications = await fetchSpecifications({token, apiKey, config: options.commandConfig})\n\n  let localApp = await loadApp({directory: options.directory, specifications, configName})\n\n  if (!options.skipDependenciesInstallation && !localApp.usesWorkspaces) {\n    localApp = await installAppDependencies(localApp)\n  }\n\n  if (\n    isCurrentAppSchema(localApp.configuration) &&\n    !localApp.configuration.access_scopes?.use_legacy_install_flow &&\n    getAppScopesArray(localApp.configuration).sort().join(',') !== remoteApp.requestedAccessScopes?.sort().join(',')\n  ) {\n    const nextSteps = [\n      [\n        'Run',\n        {command: formatPackageManagerCommand(localApp.packageManager, 'shopify app config push')},\n        'to push your scopes to the Partner Dashboard',\n      ],\n    ]\n\n    renderWarning({\n      headline: [`The scopes in your TOML don't match the scopes in your Partner Dashboard`],\n      body: [\n        `Scopes in ${basename(localApp.configuration.path)}:`,\n        scopesMessage(getAppScopesArray(localApp.configuration)),\n        '\\n',\n        'Scopes in Partner Dashboard:',\n        scopesMessage(remoteApp.requestedAccessScopes || []),\n      ],\n      nextSteps,\n    })\n  }\n\n  const frontendConfig = localApp.webs.find((web) => isWebType(web, WebType.Frontend))\n  const backendConfig = localApp.webs.find((web) => isWebType(web, WebType.Backend))\n\n  await validateCustomPorts(localApp.webs)\n\n  const [{frontendUrl, frontendPort, usingLocalhost}, backendPort, currentURLs] = await Promise.all([\n    generateFrontendURL({\n      ...options,\n      tunnelClient,\n    }),\n    getBackendPort() || backendConfig?.configuration.port || getAvailableTCPPort(),\n    getURLs(apiKey, token),\n  ])\n  let frontendServerPort = frontendConfig?.configuration.port\n  if (frontendConfig) {\n    if (!frontendServerPort) {\n      frontendServerPort = frontendConfig === backendConfig ? backendPort : await getAvailableTCPPort()\n    }\n    frontendConfig.configuration.port = frontendServerPort\n  }\n\n  const exposedUrl = usingLocalhost ? `${frontendUrl}:${frontendPort}` : frontendUrl\n  let shouldUpdateURLs = false\n  if (frontendConfig || backendConfig) {\n    if (options.update) {\n      const newURLs = generatePartnersURLs(\n        exposedUrl,\n        localApp.webs.map(({configuration}) => configuration.auth_callback_path).find((path) => path),\n        isCurrentAppSchema(localApp.configuration) ? localApp.configuration.app_proxy : undefined,\n      )\n      shouldUpdateURLs = await shouldOrPromptUpdateURLs({\n        currentURLs,\n        appDirectory: localApp.directory,\n        cachedUpdateURLs,\n        newApp: remoteApp.newApp,\n        localApp,\n        apiKey,\n      })\n      if (shouldUpdateURLs) await updateURLs(newURLs, apiKey, token, localApp)\n      await outputUpdateURLsResult(shouldUpdateURLs, newURLs, remoteApp, localApp)\n    }\n  }\n\n  // If we have a real UUID for an extension, use that instead of a random one\n  const prodEnvIdentifiers = getAppIdentifiers({app: localApp})\n  {\n    const envExtensionsIds = prodEnvIdentifiers.extensions || {}\n    const extensionsIds = prodEnvIdentifiers.app === apiKey ? envExtensionsIds : {}\n    localApp.allExtensions.forEach((ext) => (ext.devUUID = extensionsIds[ext.localIdentifier] ?? ext.devUUID))\n  }\n\n  // By default, preview goes to the direct URL for the app.\n  let previewUrl = buildAppURLForWeb(storeFqdn, apiKey)\n\n  const proxyPort = usingLocalhost ? await getAvailableTCPPort() : frontendPort\n  const proxyUrl = usingLocalhost ? `${frontendUrl}:${proxyPort}` : frontendUrl\n\n  const apiSecret = (remoteApp.apiSecret as string) ?? ''\n\n  const additionalProcesses: OutputProcess[] = []\n  const proxyTargets: ReverseHTTPProxyTarget[] = []\n\n  {\n    const hmrServerPort = frontendConfig?.configuration.hmr_server ? await getAvailableTCPPort() : undefined\n    const webOptions = {\n      apiKey,\n      scopes: isLegacyAppSchema(localApp.configuration)\n        ? localApp.configuration.scopes\n        : localApp.configuration.access_scopes?.scopes,\n      apiSecret,\n      backendPort,\n      frontendServerPort,\n      hmrServerPort,\n    }\n\n    await Promise.all(\n      localApp.webs.map(async (web) => {\n        const isFrontend = isWebType(web, WebType.Frontend)\n        const hostname = isFrontend ? frontendUrl : exposedUrl\n        const fullWebOptions: DevWebOptions = {...webOptions, web, hostname}\n\n        if (isFrontend && !usingLocalhost) {\n          proxyTargets.push(await devProxyTarget(fullWebOptions))\n        } else {\n          let port: number\n          if (isFrontend) {\n            port = frontendPort\n          } else if (isWebType(web, WebType.Backend)) {\n            port = backendPort\n          } else {\n            port = await getAvailableTCPPort()\n          }\n          additionalProcesses.push(await devNonProxyTarget(fullWebOptions, port))\n        }\n      }),\n    )\n  }\n\n  const unifiedDeployment = remoteApp?.betas?.unifiedAppDeployment ?? false\n  const deploymentMode = unifiedDeployment ? 'unified' : 'legacy'\n\n  const previewableExtensions = localApp.allExtensions.filter((ext) => ext.isPreviewable)\n  const draftableExtensions = localApp.allExtensions.filter((ext) => ext.isDraftable(unifiedDeployment))\n  const themeExtensions = localApp.allExtensions.filter((ext) => ext.isThemeExtension)\n\n  if (previewableExtensions.length > 0) {\n    // If any previewable extensions, the preview URL should be the dev console approach\n    previewUrl = `${proxyUrl}/extensions/dev-console`\n    const devExt = await devUIExtensionsTarget({\n      app: localApp,\n      id: remoteApp.id,\n      apiKey,\n      url: proxyUrl,\n      storeFqdn,\n      grantedScopes: remoteApp.grantedScopes,\n      subscriptionProductUrl: options.subscriptionProductUrl,\n      checkoutCartUrl: options.checkoutCartUrl,\n      extensions: previewableExtensions,\n    })\n    proxyTargets.push(devExt)\n  }\n\n  if (draftableExtensions.length > 0) {\n    const identifiers = await ensureDeploymentIdsPresence({\n      app: localApp,\n      partnersApp: remoteApp,\n      appId: apiKey,\n      appName: remoteApp.title,\n      force: true,\n      deploymentMode,\n      token,\n      envIdentifiers: prodEnvIdentifiers,\n    })\n\n    if (isCurrentAppSchema(localApp.configuration)) {\n      await updateAppIdentifiers({app: localApp, identifiers, command: 'deploy'})\n    }\n\n    additionalProcesses.push(\n      devDraftableExtensionTarget({\n        app: localApp,\n        apiKey,\n        url: proxyUrl,\n        token,\n        extensions: draftableExtensions,\n        remoteExtensions: identifiers.extensionIds,\n        unifiedDeployment,\n      }),\n    )\n  }\n\n  if (themeExtensions.length > 0) {\n    const adminSession = await ensureAuthenticatedAdmin(storeFqdn)\n    const extension = themeExtensions[0]!\n    let optionsToOverwrite = {}\n    if (!options.theme) {\n      const theme = await new HostThemeManager(adminSession).findOrCreate()\n      optionsToOverwrite = {\n        theme: theme.id.toString(),\n        generateTmpTheme: true,\n      }\n    }\n    const [storefrontToken, args] = await Promise.all([\n      ensureAuthenticatedStorefront(),\n      themeExtensionArgs(extension, apiKey, token, {...options, ...optionsToOverwrite}),\n    ])\n    const devExt = devThemeExtensionTarget(args, adminSession, storefrontToken, token, unifiedDeployment)\n    additionalProcesses.push(devExt)\n  }\n\n  const webhooksPath =\n    localApp.webs.map(({configuration}) => configuration.webhooks_path).find((path) => path) || '/api/webhooks'\n  const sendUninstallWebhook = Boolean(webhooksPath) && remoteAppUpdated && Boolean(frontendConfig || backendConfig)\n\n  if (sendUninstallWebhook) {\n    additionalProcesses.push({\n      prefix: 'webhooks',\n      action: async (stdout: Writable, stderr: Writable, signal: AbortSignal) => {\n        // If we have a backend, use that port, otherwise use the frontend port\n        const deliveryPort = backendConfig ? backendPort : frontendPort\n\n        await sendUninstallWebhookToAppServer({\n          stdout,\n          token,\n          address: `http://localhost:${deliveryPort}${webhooksPath}`,\n          sharedSecret: apiSecret,\n          storeFqdn,\n        })\n      },\n    })\n  }\n\n  setPreviousAppId(options.directory, apiKey)\n\n  await logMetadataForDev({devOptions: options, tunnelUrl: frontendUrl, shouldUpdateURLs, storeFqdn, deploymentMode})\n\n  await reportAnalyticsEvent({config: options.commandConfig})\n\n  const abortController = new AbortController()\n\n  const processesIncludingAnyProxies = await runConcurrentHTTPProcessesAndPathForwardTraffic({\n    portNumber: proxyPort,\n    proxyTargets,\n    additionalProcesses,\n    abortController,\n  })\n\n  const app = {\n    canEnablePreviewMode: canEnablePreviewMode(remoteApp, localApp),\n    developmentStorePreviewEnabled,\n    apiKey,\n    token,\n  }\n\n  await renderDev({\n    processes: processesIncludingAnyProxies,\n    previewUrl,\n    app,\n    abortController,\n  })\n}\n\nexport function setPreviousAppId(directory: string, apiKey: string) {\n  setCachedAppInfo({directory, previousAppId: apiKey})\n}\n\nfunction isWebType(web: Web, type: WebType): boolean {\n  return web.configuration.roles.includes(type)\n}\n\ninterface DevWebOptions {\n  web: Web\n  backendPort: number\n  frontendServerPort: number | undefined\n  hmrServerPort?: number\n  apiKey: string\n  apiSecret?: string\n  hostname?: string\n  scopes?: string\n}\n\nasync function devNonProxyTarget(options: DevWebOptions, port: number): Promise<OutputProcess> {\n  const {logPrefix, action} = await devProxyTarget(options)\n  return {\n    prefix: logPrefix,\n    action: async (stdout: Writable, stderr: Writable, signal: AbortSignal) => {\n      await action(stdout, stderr, signal, port)\n    },\n  }\n}\n\nfunction devThemeExtensionTarget(\n  args: string[],\n  adminSession: AdminSession,\n  storefrontToken: string,\n  token: string,\n  unifiedDeployment = false,\n): OutputProcess {\n  return {\n    prefix: 'extensions',\n    action: async (stdout: Writable, stderr: Writable, signal: AbortSignal) => {\n      await execCLI2(['extension', 'serve', ...args], {\n        store: adminSession.storeFqdn,\n        adminToken: adminSession.token,\n        storefrontToken,\n        token,\n        stdout,\n        stderr,\n        signal,\n        unifiedDeployment,\n      })\n    },\n  }\n}\n\nasync function devProxyTarget(options: DevWebOptions): Promise<ReverseHTTPProxyTarget> {\n  const port = options.web.configuration.port\n\n  const hmrServerOptions =\n    options.hmrServerPort && options.web.configuration.roles.includes(WebType.Frontend)\n      ? {\n          port: options.hmrServerPort,\n          httpPaths: options.web.configuration.hmr_server!.http_paths,\n        }\n      : undefined\n\n  return {\n    logPrefix: options.web.configuration.name ?? ['web', ...options.web.configuration.roles].join('-'),\n    customPort: port,\n    ...(hmrServerOptions && {hmrServer: hmrServerOptions}),\n    action: async (stdout: Writable, stderr: Writable, signal: AbortSignal, port: number) => {\n      return launchWebProcess(\n        {stdout, stderr, abortSignal: signal},\n        {\n          port,\n          apiKey: options.apiKey,\n          apiSecret: options.apiSecret,\n          hostname: options.hostname,\n          backendPort: options.backendPort,\n          frontendServerPort: options.frontendServerPort,\n          directory: options.web.directory,\n          devCommand: options.web.configuration.commands.dev,\n          scopes: options.scopes,\n          shopCustomDomain: isSpinEnvironment() ? `shopify.${await spinFqdn()}` : undefined,\n          hmrServerOptions,\n        },\n      )\n    },\n  }\n}\n\nexport interface LaunchWebOptions {\n  port: number\n  apiKey: string\n  apiSecret?: string\n  hostname?: string\n  backendPort: number\n  frontendServerPort?: number\n  directory: string\n  devCommand: string\n  scopes?: string\n  shopCustomDomain?: string\n  hmrServerOptions?: {port: number; httpPaths: string[]}\n  portFromConfig?: number\n}\n\nexport async function launchWebProcess(\n  {stdout, stderr, abortSignal}: {stdout: Writable; stderr: Writable; abortSignal: AbortSignal},\n  {\n    port,\n    apiKey,\n    apiSecret,\n    hostname,\n    backendPort,\n    frontendServerPort,\n    directory,\n    devCommand,\n    scopes,\n    shopCustomDomain,\n    hmrServerOptions,\n  }: LaunchWebOptions,\n) {\n  const hmrServerPort = hmrServerOptions?.port\n  const [cmd, ...args] = devCommand.split(' ')\n\n  const env = {\n    SHOPIFY_API_KEY: apiKey,\n    SHOPIFY_API_SECRET: apiSecret,\n    HOST: hostname,\n    SCOPES: scopes,\n    NODE_ENV: `development`,\n    ...(shopCustomDomain && {\n      SHOP_CUSTOM_DOMAIN: shopCustomDomain,\n    }),\n    BACKEND_PORT: `${backendPort}`,\n    FRONTEND_PORT: `${frontendServerPort}`,\n    ...(hmrServerPort && {\n      HMR_SERVER_PORT: `${hmrServerPort}`,\n    }),\n    APP_URL: hostname,\n    APP_ENV: 'development',\n    // Note: These are Remix-specific variables\n    REMIX_DEV_ORIGIN: hostname,\n  }\n\n  await exec(cmd!, args, {\n    cwd: directory,\n    stdout,\n    stderr,\n    signal: abortSignal,\n    env: {\n      ...env,\n      PORT: `${port}`,\n      // Note: These are Laravel variables for backwards compatibility with 2.0 templates.\n      SERVER_PORT: `${port}`,\n    },\n  })\n}\n\ninterface DevUIExtensionsTargetOptions {\n  app: AppInterface\n  apiKey: string\n  url: string\n  storeFqdn: string\n  grantedScopes: string[]\n  id?: string\n  subscriptionProductUrl?: string\n  checkoutCartUrl?: string\n  extensions: ExtensionInstance[]\n}\n\nasync function devUIExtensionsTarget({\n  app,\n  apiKey,\n  id,\n  url,\n  storeFqdn,\n  grantedScopes,\n  subscriptionProductUrl,\n  checkoutCartUrl,\n  extensions,\n}: DevUIExtensionsTargetOptions): Promise<ReverseHTTPProxyTarget> {\n  const cartUrl = await buildCartURLIfNeeded(extensions, storeFqdn, checkoutCartUrl)\n  return {\n    logPrefix: 'extensions',\n    pathPrefix: '/extensions',\n    action: async (stdout: Writable, stderr: Writable, signal: AbortSignal, port: number) => {\n      await devUIExtensions({\n        appName: app.name,\n        appDirectory: app.directory,\n        appDotEnvFile: app.dotenv,\n        id,\n        extensions,\n        stdout,\n        stderr,\n        signal,\n        url,\n        port,\n        storeFqdn,\n        apiKey,\n        grantedScopes,\n        checkoutCartUrl: cartUrl,\n        subscriptionProductUrl,\n        manifestVersion: MANIFEST_VERSION,\n      })\n    },\n  }\n}\n\ninterface DevDraftableExtensionsOptions {\n  app: AppInterface\n  apiKey: string\n  url: string\n  token: string\n  extensions: ExtensionInstance[]\n  remoteExtensions: {\n    [key: string]: string\n  }\n  unifiedDeployment: boolean\n}\n\nexport function devDraftableExtensionTarget({\n  extensions,\n  app,\n  url,\n  apiKey,\n  token,\n  remoteExtensions,\n  unifiedDeployment,\n}: DevDraftableExtensionsOptions) {\n  return {\n    prefix: 'extensions',\n    action: async (stdout: Writable, stderr: Writable, signal: AbortSignal) => {\n      // Functions will only be passed to this target if unified deployments are enabled\n      // ESBuild will take care of triggering an initial build & upload for the extensions with ESBUILD feature.\n      // For the rest we need to manually upload an initial draft.\n      const initialDraftExtensions = extensions.filter((ext) => !ext.isESBuildExtension)\n      await Promise.all(\n        initialDraftExtensions.map(async (extension) => {\n          await extension.build({app, stdout, stderr, useTasks: false, signal})\n          const registrationId = remoteExtensions[extension.localIdentifier]\n          if (!registrationId) throw new AbortError(`Extension ${extension.localIdentifier} not found on remote app.`)\n          await updateExtensionDraft({extension, token, apiKey, registrationId, stdout, stderr, unifiedDeployment})\n        }),\n      )\n\n      await Promise.all(\n        extensions\n          .map((extension) => {\n            const registrationId = remoteExtensions[extension.localIdentifier]\n            if (!registrationId) throw new AbortError(`Extension ${extension.localIdentifier} not found on remote app.`)\n\n            const actions = [\n              setupConfigWatcher({\n                extension,\n                token,\n                apiKey,\n                registrationId,\n                stdout,\n                stderr,\n                signal,\n                unifiedDeployment,\n              }),\n            ]\n\n            // Only extensions with esbuild feature should be whatched using esbuild\n            if (extension.features.includes('esbuild')) {\n              actions.push(\n                setupDraftableExtensionBundler({\n                  extension,\n                  app,\n                  url,\n                  token,\n                  apiKey,\n                  registrationId,\n                  stderr,\n                  stdout,\n                  signal,\n                  unifiedDeployment,\n                }),\n              )\n            }\n\n            // watch for Function changes that require a build and push\n            if (extension.isFunctionExtension) {\n              // watch for changes\n              actions.push(\n                setupFunctionWatcher({\n                  extension,\n                  app,\n                  stdout,\n                  stderr,\n                  signal,\n                  token,\n                  apiKey,\n                  registrationId,\n                  unifiedDeployment,\n                }),\n              )\n            }\n\n            return actions\n          })\n          .flat(),\n      )\n    },\n  }\n}\n\n/**\n * To prepare Checkout UI Extensions for dev'ing we need to retrieve a valid product variant ID\n * @param extensions - The UI Extensions to dev\n * @param store - The store FQDN\n */\nexport async function buildCartURLIfNeeded(extensions: ExtensionInstance[], store: string, checkoutCartUrl?: string) {\n  const hasUIExtension = extensions.map((ext) => ext.type).includes('checkout_ui_extension')\n  if (!hasUIExtension) return undefined\n  if (checkoutCartUrl) return checkoutCartUrl\n  const variantId = await fetchProductVariant(store)\n  return `/cart/${variantId}:1`\n}\n\nexport async function logMetadataForDev(options: {\n  devOptions: DevOptions\n  tunnelUrl: string\n  shouldUpdateURLs: boolean\n  storeFqdn: string\n  deploymentMode: DeploymentMode | undefined\n}) {\n  const tunnelType = await getAnalyticsTunnelType(options.devOptions.commandConfig, options.tunnelUrl)\n  await metadata.addPublicMetadata(() => ({\n    cmd_dev_tunnel_type: tunnelType,\n    cmd_dev_tunnel_custom_hash: tunnelType === 'custom' ? hashString(options.tunnelUrl) : undefined,\n    cmd_dev_urls_updated: options.shouldUpdateURLs,\n    store_fqdn_hash: hashString(options.storeFqdn),\n    cmd_app_dependency_installation_skipped: options.devOptions.skipDependenciesInstallation,\n    cmd_app_reset_used: options.devOptions.reset,\n    cmd_app_deployment_mode: options.deploymentMode,\n  }))\n\n  await metadata.addSensitiveMetadata(() => ({\n    store_fqdn: options.storeFqdn,\n    cmd_dev_tunnel_custom: tunnelType === 'custom' ? options.tunnelUrl : undefined,\n  }))\n}\n\nexport async function validateCustomPorts(webConfigs: Web[]) {\n  const allPorts = webConfigs.map((config) => config.configuration.port).filter((port) => port)\n  const duplicatedPort = allPorts.find((port, index) => allPorts.indexOf(port) !== index)\n  if (duplicatedPort) {\n    throw new AbortError(`Found port ${duplicatedPort} for multiple webs.`, 'Please define a unique port for each web.')\n  }\n  await Promise.all(\n    allPorts.map(async (port) => {\n      const portAvailable = await checkPortAvailability(port!)\n      if (!portAvailable) {\n        throw new AbortError(`Hard-coded port ${port} is not available, please choose a different one.`)\n      }\n    }),\n  )\n}\n\nexport function scopesMessage(scopes: string[]) {\n  return {\n    list: {\n      items: scopes.length === 0 ? ['No scopes'] : scopes,\n    },\n  }\n}\n\nexport default dev\n"]}