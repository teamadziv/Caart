{"version":3,"file":"app.test-data.js","sourceRoot":"","sources":["../../../../src/cli/models/app/app.test-data.ts"],"names":[],"mappings":"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","sourcesContent":["import {App, AppInterface} from './app.js'\nimport {FunctionExtension, ThemeExtension, UIExtension} from './extensions.js'\nimport {UIExtensionInstance, UIExtensionSpec} from '../extensions/ui.js'\nimport {FunctionConfigType, FunctionInstance, FunctionSpec} from '../extensions/functions.js'\nimport {ThemeExtensionInstance} from '../extensions/theme.js'\nimport themeSpec from '../extensions/theme-specifications/theme.js'\nimport {loadLocalExtensionsSpecifications} from '../extensions/specifications.js'\nimport {RemoteSpecification} from '../../api/graphql/extension_specifications.js'\n\nexport function testApp(app: Partial<AppInterface> = {}): AppInterface {\n  const newApp = new App(\n    app.name ?? 'App',\n    app.idEnvironmentVariableName ?? 'SHOPIFY_API_KEY',\n    app.directory ?? '/tmp/project',\n    app.packageManager ?? 'yarn',\n    app.configuration ?? {scopes: '', extensionDirectories: []},\n    app.configurationPath ?? '/tmp/project/shopify.app.toml',\n    app.nodeDependencies ?? {},\n    app.webs ?? [],\n    app.extensions?.ui ?? [],\n    app.extensions?.theme ?? [],\n    app.extensions?.function ?? [],\n    app.usesWorkspaces ?? false,\n    app.dotenv,\n    app.errors,\n  )\n  if (app.updateDependencies) {\n    Object.getPrototypeOf(newApp).updateDependencies = app.updateDependencies\n  }\n  if (app.hasUIExtensions) {\n    Object.getPrototypeOf(newApp).hasUIExtensions = app.hasUIExtensions\n  }\n  if (app.extensionsForType) {\n    Object.getPrototypeOf(newApp).extensionsForType = app.extensionsForType\n  }\n  return newApp\n}\n\nexport async function testUIExtension(uiExtension: Partial<UIExtension> = {}): Promise<UIExtension> {\n  const directory = uiExtension?.directory ?? '/tmp/project/extensions/test-ui-extension'\n\n  const configuration = uiExtension?.configuration ?? {\n    name: uiExtension?.configuration?.name ?? 'test-ui-extension',\n    type: uiExtension?.configuration?.type ?? uiExtension?.type ?? 'product_subscription',\n    metafields: [],\n    capabilities: {\n      block_progress: false,\n      network_access: false,\n      api_access: false,\n    },\n  }\n  const configurationPath = uiExtension?.configurationPath ?? `${directory}/shopify.ui.extension.toml`\n  const entrySourceFilePath = uiExtension?.entrySourceFilePath ?? `${directory}/src/index.js`\n\n  const allSpecs = await loadLocalExtensionsSpecifications()\n  const specification = allSpecs.find((spec) => spec.identifier === configuration.type) as UIExtensionSpec\n\n  const extension = new UIExtensionInstance({\n    configuration,\n    configurationPath,\n    entryPath: entrySourceFilePath,\n    directory,\n    specification,\n  })\n  extension.devUUID = uiExtension?.devUUID ?? 'test-ui-extension-uuid'\n  return extension\n}\n\nexport async function testThemeExtensions(): Promise<ThemeExtension> {\n  const configuration = {\n    name: 'theme extension name',\n    type: 'theme' as const,\n  }\n\n  return new ThemeExtensionInstance({\n    configuration,\n    configurationPath: '',\n    directory: './my-extension',\n    specification: themeSpec,\n    outputBundlePath: './my-extension',\n  })\n}\n\nfunction defaultFunctionConfiguration(): FunctionConfigType {\n  return {\n    name: 'test function extension',\n    description: 'description',\n    type: 'product_discounts',\n    build: {\n      command: 'echo \"hello world\"',\n    },\n    apiVersion: '2022-07',\n    configurationUi: true,\n  }\n}\n\ninterface TestFunctionExtensionOptions {\n  dir?: string\n  config?: FunctionConfigType\n}\n\nexport async function testFunctionExtension(opts: TestFunctionExtensionOptions = {}): Promise<FunctionExtension> {\n  const directory = opts.dir ?? '/tmp/project/extensions/my-function'\n  const configuration = opts.config ?? defaultFunctionConfiguration()\n\n  const allSpecs = await loadLocalExtensionsSpecifications()\n  const specification = allSpecs.find((spec) => spec.identifier === configuration.type) as FunctionSpec\n\n  return new FunctionInstance({\n    configuration,\n    configurationPath: '',\n    specification,\n    directory,\n  })\n}\n\nexport const testRemoteSpecifications: RemoteSpecification[] = [\n  {\n    name: 'Checkout Post Purchase',\n    externalName: 'Post-purchase UI',\n    identifier: 'checkout_post_purchase',\n    externalIdentifier: 'checkout_post_purchase_external',\n    gated: false,\n    options: {\n      managementExperience: 'cli',\n      registrationLimit: 1,\n    },\n    features: {\n      argo: {\n        surface: 'checkout',\n      },\n    },\n  },\n  {\n    name: 'Online Store - App Theme Extension',\n    externalName: 'Theme App Extension',\n    identifier: 'theme',\n    externalIdentifier: 'theme_external',\n    gated: false,\n    options: {\n      managementExperience: 'cli',\n      registrationLimit: 1,\n    },\n  },\n  {\n    name: 'Product Subscription',\n    externalName: 'Subscription UI',\n    identifier: 'product_subscription',\n    externalIdentifier: 'product_subscription_external',\n    gated: false,\n    options: {\n      managementExperience: 'cli',\n      registrationLimit: 1,\n    },\n    features: {\n      argo: {\n        surface: 'admin',\n      },\n    },\n  },\n  {\n    name: 'UI Extension',\n    externalName: 'UI Extension',\n    identifier: 'ui_extension',\n    externalIdentifier: 'ui_extension_external',\n    gated: false,\n    options: {\n      managementExperience: 'cli',\n      registrationLimit: 50,\n    },\n    features: {\n      argo: {\n        surface: 'all',\n      },\n    },\n  },\n  {\n    name: 'Customer Accounts',\n    externalName: 'Customer Accounts',\n    identifier: 'customer_accounts_ui_extension',\n    externalIdentifier: 'customer_accounts_ui_extension_external',\n    gated: false,\n    options: {\n      managementExperience: 'cli',\n      registrationLimit: 10,\n    },\n    features: {\n      argo: {\n        surface: 'customer_accounts',\n      },\n    },\n  },\n  {\n    name: 'Checkout Extension',\n    externalName: 'Checkout UI',\n    identifier: 'checkout_ui_extension',\n    externalIdentifier: 'checkout_ui_extension_external',\n    gated: false,\n    options: {\n      managementExperience: 'cli',\n      registrationLimit: 5,\n    },\n    features: {\n      argo: {\n        surface: 'checkout',\n      },\n    },\n  },\n  {\n    name: 'Product Subscription',\n    externalName: 'Subscription UI',\n    // we are going to replace this to 'product_subscription' because we\n    // started using it before relying on the extension specification identifier\n    identifier: 'subscription_management',\n    externalIdentifier: 'product_subscription_external',\n    gated: false,\n    options: {\n      managementExperience: 'cli',\n      registrationLimit: 1,\n    },\n    features: {\n      argo: {\n        surface: 'admin',\n      },\n    },\n  },\n  {\n    name: 'Marketing Activity',\n    externalName: 'Marketing Activity',\n    identifier: 'marketing_activity_extension',\n    externalIdentifier: 'marketing_activity_extension_external',\n    gated: false,\n    options: {\n      managementExperience: 'dashboard',\n      registrationLimit: 100,\n    },\n  },\n]\n"]}